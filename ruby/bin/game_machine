#!/usr/bin/env ruby
require 'slop'

opts = Slop.parse(:help => true) do
  banner 'Usage: datacube [options]'

  on '--cluster',  'Scanner supervisor'
  on '--seed',  'Scanner supervisor'
  on 'name=',  'Server name'
  on '--server',  'Scanner supervisor'
  on '--stop',  'Scanner supervisor'

  help
end

begin
  require "game_machine"
rescue LoadError
  require_relative "../lib/game_machine"
end

if opts.stop?
  GameMachine::Server.instance.init!
  GameMachine::Server.instance.kill_all
end

server_opts = {}

if opts.cluster?
  server_opts[:cluster] = true
  if opts.seed?
    server_opts[:seed] = true
  end
end

if opts.server? || opts.cluster?
  GameMachine::Server.instance.init!(
    (opts[:name] || 'default'), server_opts
  )
  GameMachine::Server.instance.start
end
