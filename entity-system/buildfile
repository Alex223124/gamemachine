# Generated by Buildr 1.4.12, change to your liking
require 'buildr/ide/eclipse'

working_dir = File.join(Dir.getwd,'lib')

# Version number for this release
VERSION_NUMBER = "0.0.1-SNAPSHOT"
# Group identifier for your projects
GROUP = "entity-system"
COPYRIGHT = ""

# Specify Maven 2.0 remote repositories here, like this:
repositories.remote << "http://repo.maven.apache.org/maven2"
repositories.remote << 'http://www.ibiblio.org/maven2/'

Project.local_task :protogen
Project.local_task :codegen
Project.local_task :buildall
Project.local_task :real_clean


desc "The Entity-system project"
define "entity-system" do

  
  project.version = VERSION_NUMBER
  project.group = GROUP
  manifest["Implementation-Vendor"] = COPYRIGHT
  dependencies = []
   dependencies << 'org.slf4j:log4j-over-slf4j:jar:1.7.5'
  dependencies << 'ch.qos.logback:logback-classic:jar:1.0.13'
  dependencies << 'org.testng:testng:jar:6.8.1'
  dependencies << 'org.easytesting:fest-assert-core:jar:2.0M10'
  dependencies << 'com.dyuproject.protostuff:protostuff-uberjar:jar:1.0.7'
  dependencies << 'com.dyuproject.protostuff:protostuff-compiler:jar:1.0.7'
  dependencies << 'com.dyuproject.protostuff:protostuff-json:jar:1.0.7'
  dependencies << 'com.dyuproject.protostuff:protostuff-yaml:jar:1.0.7'
  dependencies << 'com.dyuproject.protostuff:protostuff-xml:jar:1.0.7'
  dependencies << 'org.slf4j:slf4j-api:jar:1.7.5'
  dependencies << 'org.slf4j:slf4j-simple:jar:1.7.5'
  
 
  
  
  layout[:source, :main, :java] = "src"
  layout[:source, :main, :scala] = "src"
  layout[:target, :main] = "bin"
  layout[:target, :main, :java] = "bin"
  layout[:target, :main, :scala] = "bin"
  
  package_with_sources
  package_with_javadoc
  package :jar
  test.using :testng
  compile.using :target=>'1.7', :lint=>'all'
  compile.with transitive(dependencies) # Add more classpath dependencies
  compile.dependencies
  
  task :real_clean do
  	Dir.glob("lib/*.jar").each {|file| FileUtils.rm file}
  	path = path_to('src','main','java','com','game_machine','entity_system','generated')
  	Dir.glob("#{path}/*.java").each {|file| FileUtils.rm file}
  end
  
  task :protogen => [:real_clean, :clean] do
  	system("java -jar protostuff-compiler-1.0.7-jarjar.jar src/main/resources/protostuff.properties")
  end
  
  task :install_libs => :package do
  	artifacts = Buildr.artifacts(dependencies).map(&:to_s)
    artifacts.each do |artifact|
        FileUtils.copy artifact, "#{path_to('lib')}" 
    end
    FileUtils.copy "target/entity-system-#{VERSION_NUMBER}.jar", "lib"
  end
  
  task :codegen => [:protogen, :install_libs] do
    system("jruby src/main/resources/template.rb")
  end
  
  task :buildall => :codegen do
  end
  
end

